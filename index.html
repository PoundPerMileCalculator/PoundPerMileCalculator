<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pound Per Mile Calculator</title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;700&display=swap" rel="stylesheet">
  <!-- External CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="container">
    <!-- Stylish README / Instructions -->
    <div id="readme" class="readme">
      <h2>Welcome to the Pound Per Mile Calculator</h2>
      <p>
        Compare the running cost of any vehicle in the UK using regional fuel and energy prices. 
        Select your vehicle brand and model, choose your area, and see how much it costs to drive per mile.
      </p>
      <p>
        Perfect for budgeting or comparing vehicles across petrol, diesel, hybrid, and electric types.
      </p>
    </div>

    <h1>Pound Per Mile Calculator</h1>

    <!-- Brand Dropdown -->
    <label for="brand">Select Brand:</label>
    <select id="brand">
      <option value="">--Select Brand--</option>
    </select>

    <!-- Model Dropdown -->
    <label for="model">Select Model:</label>
    <select id="model" disabled>
      <option value="">--Select a Brand First--</option>
    </select>

    <!-- Area Dropdown -->
    <label for="area">Select Area:</label>
    <select id="area">
      <option value="">--Select Area--</option>
      <option value="Wales">Wales</option>
      <option value="Scotland">Scotland</option>
      <option value="North England">North England</option>
      <option value="East England">East England</option>
      <option value="South England">South England</option>
      <option value="West England">West England</option>
      <option value="London">London</option>
    </select>

    <!-- Calculate Button -->
    <button id="calculateBtn" disabled>Calculate £/Mile</button>

    <!-- Result Display -->
    <div id="result"></div>
  </div>

  <script>
    // Fuel & Energy Prices
    const fuelPrices = {
      "Wales": { petrol: 135, diesel: 143 },
      "Scotland": { petrol: 135, diesel: 144 },
      "North England": { petrol: 136, diesel: 145 },
      "East England": { petrol: 137, diesel: 145 },
      "South England": { petrol: 138, diesel: 146 },
      "West England": { petrol: 136, diesel: 144 },
      "London": { petrol: 138, diesel: 146 }
    };

    const energyPrices = {
      "Wales": 25.8,
      "Scotland": 26.0,
      "North England": 25.0,
      "East England": 26.0,
      "South England": 26.9,
      "West England": 26.0,
      "London": 26.05
    };

    let vehiclesData = {};

    const brandSelect = document.getElementById('brand');
    const modelSelect = document.getElementById('model');
    const areaSelect = document.getElementById('area');
    const calculateBtn = document.getElementById('calculateBtn');
    const resultDiv = document.getElementById('result');

    // Load vehicles JSON
    fetch('vehicles.json')
      .then(response => {
        if (!response.ok) throw new Error("HTTP error " + response.status);
        return response.json();
      })
      .then(data => {
        vehiclesData = data;
        populateBrands();
      })
      .catch(err => {
        console.error("Error loading vehicles.json:", err);
        alert("Failed to load vehicle data. Check console for details.");
      });

    // Populate Brands
    function populateBrands() {
      brandSelect.innerHTML = '<option value="">--Select Brand--</option>';
      Object.keys(vehiclesData).forEach(brand => {
        const option = document.createElement('option');
        option.value = brand;
        option.textContent = brand;
        brandSelect.appendChild(option);
      });

      // Enable model dropdown when brand selected
      brandSelect.addEventListener('change', () => {
        modelSelect.disabled = !brandSelect.value;
        populateModels();
        checkButtonState();
      });
    }

    // Populate Models
    function populateModels() {
      const brand = brandSelect.value;
      modelSelect.innerHTML = '<option value="">--Select Model--</option>';

      if (!brand || !vehiclesData[brand]) return;

      vehiclesData[brand].forEach(vehicle => {
        const option = document.createElement('option');
        option.value = vehicle.model;
        option.textContent = vehicle.model;
        modelSelect.appendChild(option);
      });
    }

    // Enable/Disable calculate button
    function checkButtonState() {
      if (brandSelect.value && modelSelect.value && areaSelect.value) {
        calculateBtn.disabled = false;
      } else {
        calculateBtn.disabled = true;
      }
    }

    // Monitor changes to update button state
    modelSelect.addEventListener('change', checkButtonState);
    areaSelect.addEventListener('change', checkButtonState);

    // Calculate £/mile
    calculateBtn.addEventListener('click', () => {
      const brand = brandSelect.value;
      const model = modelSelect.value;
      const area = areaSelect.value;

      const vehicle = vehiclesData[brand].find(v => v.model === model);
      if (!vehicle) {
        alert("Vehicle data not found.");
        return;
      }

      let costPerMile = 0;
      const fuelType = vehicle.fuel;

      if (fuelType === "petrol") {
        costPerMile = (fuelPrices[area].petrol / 100) / (vehicle.mpg || 1);
      } else if (fuelType === "diesel") {
        costPerMile = (fuelPrices[area].diesel / 100) / (vehicle.mpg || 1);
      } else if (fuelType === "hybrid") {
        const petrolCost = (fuelPrices[area].petrol / 100) / (vehicle.mpg || 1);
        const electricCost = (energyPrices[area] / 100) * (vehicle.kwh_per_mile || 0.3);
        costPerMile = (petrolCost + electricCost) / 2;
      } else if (fuelType === "electric") {
        costPerMile = (energyPrices[area] / 100) * (vehicle.kwh_per_mile || 0.3);
      }

      resultDiv.innerText = `The estimated cost to run ${brand} ${model} in ${area} is £${costPerMile.toFixed(2)} per mile.`;
    });

  </script>
</body>
</html>
